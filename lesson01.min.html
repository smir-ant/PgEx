<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <title>PgEx 01</title> <link rel="stylesheet" href="css/styles.css"> <link rel="stylesheet" href="css/practice.css"> <link rel="stylesheet" href="css/theory.css"> <link rel="shortcut icon" href="assets/favicon.ico" type="image/x-icon"> </head> <body> <a id="github" href="https://github.com/smir-ant/PgEx"><img src="assets/github.svg" alt=""></a> <main> <nav> <a id="proj_name" href="index.html">PgEx</a> </nav> <section id="sect_theory"> <h1>Урок 1. Выборка: колонки.</h1> <p>Lorem, ipsum dolor sit amet consectetur adipisicing elit. Doloremque quisquam labore esse doloribus, a sed voluptatibus obcaecati voluptatem aperiam laborum excepturi voluptas maiores perferendis culpa quibusdam repellat cum ut. Dolorum aperiam aliquam inventore placeat repudiandae culpa delectus natus sapiente ratione cumque at dignissimos rerum, porro dolores adipisci suscipit vero maxime.</p> <p>Lorem, ipsum dolor sit amet consectetur adipisicing elit. Doloremque quisquam labore esse doloribus, a sed voluptatibus obcaecati voluptatem aperiam laborum excepturi voluptas maiores perferendis culpa quibusdam repellat cum ut. Dolorum aperiam aliquam inventore placeat repudiandae culpa delectus natus sapiente ratione cumque at dignissimos rerum, porro dolores adipisci suscipit vero maxime.</p> <p>Lorem, ipsum dolor sit amet consectetur adipisicing elit. Doloremque quisquam labore esse doloribus, a sed voluptatibus obcaecati voluptatem aperiam laborum excepturi voluptas maiores perferendis culpa quibusdam repellat cum ut. Dolorum aperiam aliquam inventore placeat repudiandae culpa delectus natus sapiente ratione cumque at dignissimos rerum, porro dolores adipisci suscipit vero maxime.</p> <figure class="schema"> <img src="assets/lesson01/schema_playlist.png"> <figcaption><span>Модель базы данных</span></figcaption> </figure> </section> <hr> <section id="sect_practice"> <section id="group_table"> <div id="containerTable"> <table id="dataTable">   </table> </div>  </section> <section id="group_task"> <div class="container"> <h3>Урок 1. &nbsp; Задания:</h3> <ol> <li>Find the <code>title</code> of each track</li> <li class="disabled">Find the <code>artist</code> of each track</li> <li class="disabled">Find the <code>title</code> and <code>artist</code> of each track</li> <li class="disabled">Find the <code>title</code> and year of <code>release</code> of each track</li> <li class="disabled">Find <code>all</code> the information about each track</li> </ol> </div> <a class="btn disabled" href="lesson02.html" id="finishBtn">Выполни задания выше</a> </section> <section id="group_code">   </section> </section> </main> <script src="scripts/higlightSQL.js">;</script> <script src="scripts/isRightAns.js">;</script> <script src="scripts/fillTableHtml.js">;</script> <script src="scripts/status.js">;</script> <script src="scripts/nextTask.js">;</script> <script src="scripts/dbSchema.js" data-db="music" type="module">;</script> <script type="module">import{createDB}from"./scripts/dbSchema.js";const tablename=createDB[0];console.log("tableName:",tablename);const answers=[`SELECT title FROM ${tablename};`,`SELECT artist FROM ${tablename};`,`SELECT title, artist FROM ${tablename};`,`SELECT title, release FROM ${tablename};`,`SELECT * FROM ${tablename};`],dataTable=document.getElementById("dataTable"),sqlInput=document.getElementById("sqlInput");sqlInput.innerHTML=`SELECT * FROM ${tablename};`,highlightEl();let db=null;import{PGlite}from"https://cdn.jsdelivr.net/npm/@electric-sql/pglite/dist/index.js";async function initializeDB(){setStatus("Загрузка..."),db=new PGlite,await db.query(`CREATE TABLE ${tablename}`+createDB[1]),await db.query(`INSERT INTO ${tablename}`+createDB[2]);const e=await db.query(`SELECT * FROM ${tablename};`);fillTableHtml(e.rows,e.fields),setStatus(`БД готова к работе. Всего записей: ${e.rows.length}`)}let error_translate={"syntax error at or near ":"синтаксическая ошибка возле ","argument of WHERE must be type boolean":"...","operator does not exist: integer == inte":"...","cannot insert multiple commands into a p":"..."};async function executeSQL(){const e=sqlInput.innerHTML.replaceAll("<div>"," ").replaceAll("</div>","").replaceAll("<br>","").replaceAll("&lt;","<").replaceAll("&gt;",">").replace(/(--.*$)/gm,"").replace(/\/\*[\s\S]*?\*\//gm,"").trim();if(e){setStatus(`Выполняем запрос: ${e}`);try{if(e.toLowerCase().startsWith("select")){const t=await db.query(e);fillTableHtml(t.rows,t.fields),setStatus(`Запрос выполнен. Вернуто ${t.rows.length} строк.`);const a=await db.query(answers[currentTask]);isRightAnswer(t.rows,a.rows)&&nextTask()}else{const t=await db.exec(`\n                        BEGIN;\n                        ${e}\n                        -- Делаем SELECT для просмотра изменений\n                        SELECT * FROM ${tablename};\n\n                        -- Откатываем изменения\n                        ROLLBACK;\n                    `);fillTableHtml(t[2].rows,t[2].fields),setStatus(`Запрос выполнен. Вернуто ${t[2].rows.length} строк.`)}}catch(e){setStatus(`Ошибка при выполнении запроса: ${e.message}`)}}else setStatus("Введи SQL запрос.")}sqlInput.oninput=executeSQL,window.onload=()=>initializeDB();</script> 